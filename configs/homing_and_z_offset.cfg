[gcode_macro ADJUST_Z_OFFSET_FOR_PROBE_TEMPERATURE]
default_parameter_MIN_OFFSET: 0
default_parameter_MIN_TEMP: 20
default_parameter_MAX_OFFSET: 0
default_parameter_MAX_TEMP: 40
gcode:
    {% set current_temp = printer["temperature_sensor chamber_temp_at_xchain"].temperature %}
    {% set z_offset = -((current_temp - MIN_TEMP|float) * (MAX_OFFSET|float - MIN_OFFSET|float) / (MAX_TEMP|float - MIN_TEMP|float) + MIN_OFFSET|float)|round(3, 'common') %}
    { action_respond_info("Adjusting Z-Offset by: " + z_offset|string + " (Temp: " + current_temp|round(1, 'common')|string + ")") }
    SET_GCODE_OFFSET Z_ADJUST={z_offset} MOVE=1
    
[gcode_macro ADJUST_Z_OFFSET_POWDERCOATED_PEI]
default_parameter_Z_OFFSET: 0
gcode:
    SET_GCODE_OFFSET Z_ADJUST={Z_OFFSET} MOVE=1
    
[gcode_macro ADJUST_Z_OFFSET_SMOOTH_PEI]
default_parameter_Z_OFFSET: 0.18
gcode:
    SET_GCODE_OFFSET Z_ADJUST={Z_OFFSET} MOVE=1
    
[gcode_macro ADJUST_Z_PLUS]
default_parameter_Z_OFFSET: 0.18
gcode:
    SET_GCODE_OFFSET Z_ADJUST=0.01 MOVE=1
    
[gcode_macro ADJUST_Z_MINUS]
default_parameter_Z_OFFSET: 0.18
gcode:
    SET_GCODE_OFFSET Z_ADJUST=-0.01 MOVE=1

[homing_override]
axes: z
set_position_z: 0
gcode:
    SET_VELOCITY_LIMIT ACCEL=500 ACCEL_TO_DECEL=500
    G90
    G0 Z5 F500
    G28 X0 Y0
    G0 X128 Y105 F9000
    G28 Z0
    G0 Z10 F500