

[adxl345 hotend]
cs_pin: rpi:None
spi_bus: spidev0.1
axes_map: x,y,z

[adxl345 bed]
cs_pin: rpi:None
spi_bus: spidev0.0
axes_map: x,y,z

[resonance_tester]
# Assuming the typical setup of the bed slinger printer
accel_chip_x: adxl345 hotend
accel_chip_y: adxl345 bed
probe_points:
    128.00, 100.00, 102.40
    
[input_shaper]
shaper_freq_x: 76.6
shaper_type_x: 2hump_ei
shaper_freq_y: 66.4
shaper_type_y: 2hump_ei
#shaper_freq_x: 48.2
#shaper_type_x: mzv
#shaper_freq_y: 44.2
#shaper_type_y: mzv

[gcode_macro vibration_test]
gcode:
		# Set variables for axis centers
		{% set midx = printer.configfile.config.stepper_x.position_max|float / 2 %}
		{% set midy = printer.configfile.config.stepper_y.position_max|float / 2 %}
		
		#X Vibration - Stock
		G1 X{ midx - 75 } Y{ midy } Z20 F10000
		M400
		G4 P300
		ACCELEROMETER_MEASURE CHIP=hotend RATE=3200 
		G4 P300
		G1 X{ midx + 75 } Y{ midy } F10000
		G1 X{ midx - 75 } Y{ midy } F10000
		G1 X{ midx + 75 } Y{ midy } F10000
		M400
		G4 P300
		ACCELEROMETER_MEASURE CHIP=hotend RATE=0

		#Y Vibration - Stock
		G1 X{ midx } Y{ midy - 75 } Z20 F10000
		M400
		G4 P300
		ACCELEROMETER_MEASURE CHIP=bed RATE=3200
		G4 P300
		G1 X{ midx } Y{ midy + 75 } F10000
		G1 X{ midx } Y{ midy - 75 } F10000
		G1 X{ midx } Y{ midy + 75 } F10000
		M400
		G4 P300
		ACCELEROMETER_MEASURE CHIP=bed RATE=0 